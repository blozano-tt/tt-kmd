#! /bin/sh

# Generated by
# (for commit in $(git log --format=%H -- modprobe.d-tenstorrent.conf); do git show $commit:./modprobe.d-tenstorrent.conf |md5sum; done) |sort -u |cut -d" " -f1
UNMODIFIED_TENSTORRENT_CONF="1de3e34baf9f122f895fb7397e8f479f \
4e352c89c8482a6b29cfcc8c94b82d80 \
5c9842477cddcf996df21277565817c7 \
5d55a1258e8d104e16e0c9423207c691 \
700d8ac587bff597e42f3783f4d0cb82 \
7c52a78ebfb9921d2c7af7782ab5eee6 \
b817a5f060ca1d85e9a4b7aca4a02c98 \
dcaa5f81024966a5e7a78085877cb243 \
f6e9fabe90b84287834c60fb41973560"

TENSTORRENT_CONF=/etc/modprobe.d/tenstorrent.conf

if [ -f $TENSTORRENT_CONF ]; then
        TENSTORRENT_CONF_MD5SUM=$(md5sum $TENSTORRENT_CONF | cut -c1-32)

        if echo "$UNMODIFIED_TENSTORRENT_CONF" | grep -Fq $TENSTORRENT_CONF_MD5SUM; then
                cp modprobe.d-tenstorrent.conf $TENSTORRENT_CONF
        else
                echo "$TENSTORRENT_CONF has local modifications, new version copied to $TENSTORRENT_CONF.new ."
                cp modprobe.d-tenstorrent.conf $TENSTORRENT_CONF.new
        fi
else
        cp modprobe.d-tenstorrent.conf $TENSTORRENT_CONF
fi

cp udev-50-tenstorrent.rules /etc/udev/rules.d/50-tenstorrent.rules
udevadm control -R
